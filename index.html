<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Gesti√≥n Helader√≠a</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f8f8f8; padding: 20px; }
    h1, h2 { margin: 10px 0; }
    section { background: white; padding: 15px; margin: 15px 0; border-radius: 8px; box-shadow: 0 2px 6px rgba(0,0,0,.1); }
    table { width: 100%; border-collapse: collapse; margin-top: 10px; }
    th, td { border: 1px solid #ddd; padding: 6px; text-align: center; }
    th { background: #eee; }
    input, select, button { margin: 4px 0; padding: 6px; }
    button { cursor: pointer; }
  </style>
</head>
<body>
  <h1>üç¶ Gesti√≥n de Helader√≠a</h1>

  <!-- Lista de productos -->
  <section>
    <h2>Productos</h2>
    <table>
      <thead>
        <tr><th>ID</th><th>Nombre</th><th>Precio</th><th>Stock</th><th>Acciones</th></tr>
      </thead>
      <tbody id="tablaProductos"></tbody>
    </table>
  </section>

  <!-- Registrar venta -->
  <section>
    <h2>Registrar venta</h2>
    <select id="ventaProducto"></select>
    <input id="ventaCantidad" type="number" min="1" value="1">
    <button onclick="registrarVenta()">Vender</button>
  </section>

  <!-- Lista de ventas -->
  <section>
    <h2>Ventas</h2>
    <p id="resumen"></p>
    <table>
      <thead>
        <tr><th>ID</th><th>Fecha</th><th>Producto</th><th>Cant.</th><th>Total</th><th>Acciones</th></tr>
      </thead>
      <tbody id="tablaVentas"></tbody>
    </table>
  </section>

<script>
  // Lista fija de helados
  const productosBase = [
    {id:1, nombre:"Helados de agua", precio:100, stock:20},
    {id:2, nombre:"Helados de crema", precio:150, stock:20},
    {id:3, nombre:"Helado bonbom", precio:200, stock:15},
    {id:4, nombre:"Helado bonbom crocante", precio:220, stock:15},
    {id:5, nombre:"Pote 360", precio:250, stock:10},
    {id:6, nombre:"Cono bola", precio:120, stock:25}
  ];

  let productos = JSON.parse(localStorage.getItem("helad_prod")) || productosBase;
  let ventas = JSON.parse(localStorage.getItem("helad_ventas")) || [];

  function guardar() {
    localStorage.setItem("helad_prod", JSON.stringify(productos));
    localStorage.setItem("helad_ventas", JSON.stringify(ventas));
  }

  function renderProductos() {
    const tbody = document.getElementById("tablaProductos");
    tbody.innerHTML = "";
    productos.forEach(p => {
      tbody.innerHTML += `<tr>
        <td>${p.id}</td><td>${p.nombre}</td><td>$${p.precio}</td><td>${p.stock}</td>
        <td>
          <button onclick="ajustarStock(${p.id},1)">+1</button>
          <button onclick="ajustarStock(${p.id},-1)">-1</button>
        </td>
      </tr>`;
    });
    // opciones en select de venta
    const sel = document.getElementById("ventaProducto");
    sel.innerHTML = "<option value=''>-- elegir --</option>";
    productos.forEach(p => {
      sel.innerHTML += `<option value='${p.id}'>${p.nombre} (stock ${p.stock}) - $${p.precio}</option>`;
    });
  }

  function renderVentas() {
    const tbody = document.getElementById("tablaVentas");
    tbody.innerHTML = "";
    let total = 0, items = 0;
    ventas.forEach(v => {
      total += v.total; items += v.cantidad;
      tbody.innerHTML += `<tr>
        <td>${v.id}</td>
        <td>${new Date(v.fecha).toLocaleString()}</td>
        <td>${v.producto}</td>
        <td>${v.cantidad}</td>
        <td>$${v.total}</td>
        <td><button onclick="eliminarVenta(${v.id})">Eliminar</button></td>
      </tr>`;
    });
    document.getElementById("resumen").innerText = 
      `Ventas: ${ventas.length} | √çtems: ${items} | Total: $${total}`;
  }

  function ajustarStock(id, delta) {
    productos = productos.map(p=>p.id===id? {...p, stock: Math.max(0, p.stock+delta)} : p);
    guardar(); renderProductos();
  }

  function registrarVenta() {
    const pid = parseInt(document.getElementById("ventaProducto").value);
    const cantidad = parseInt(document.getElementById("ventaCantidad").value);
    if (!pid || cantidad <= 0) return alert("Datos inv√°lidos");
    const prod = productos.find(p=>p.id===pid);
    if (!prod || prod.stock < cantidad) return alert("No hay stock suficiente");
    const id = ventas.length ? Math.max(...ventas.map(v=>v.id))+1 : 1;
    const total = prod.precio * cantidad;
    ventas.unshift({id, producto: prod.nombre, cantidad, total, fecha: new Date().toISOString()});
    prod.stock -= cantidad;
    guardar(); renderProductos(); renderVentas();
  }

  function eliminarVenta(id) {
    const v = ventas.find(x=>x.id===id);
    if (v && confirm("¬øEliminar venta?")) {
      // restaurar stock
      const prod = productos.find(p=>p.nombre===v.producto);
      if (prod) prod.stock += v.cantidad;
      ventas = ventas.filter(x=>x.id!==id);
      guardar(); renderProductos(); renderVentas();
    }
  }

  renderProductos();
  renderVentas();
</script>
</body>
</html>
